<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Canvas Ondulado</title>
    <link rel="stylesheet" href="main.css" />
    <link
      href="
https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/css/splide.min.css
"
      rel="stylesheet"
    />
  </head>
  <style>
    canvas {
      display: block;
      background-color: transparent;
      position: absolute;
      z-index: -10;
      width: 100%; /* Canvas toma todo el ancho del contenedor */
      height: 100%; /* Canvas toma todo el alto del contenedor */
    }

    button {
      cursor: pointer;
    }
  </style>

  <body>
    <div class="contenedor">
      <div
        class="splide"
        id="splide-prueba"
        aria-label="Basic Structure Example"
      >
        <div class="splide__track">
          <ul class="splide__list">
            <canvas id="canvas"></canvas>
            <li class="splide__slide box" data-index="1">
              <div class="history">
                <div class="info">
                  <h3>Antes del origen</h3>
                  <p>
                    Esa noche, reventaron 36 bombas en Lima. El Perú estaba
                    sumido en una crisis ocasionada por el terrorismo. Había que
                    decidir si seguir en el Perú o dejarlo todo y viajar al
                    extranjero.
                  </p>
                </div>
                <button class="build-btn" data-progress="25">1992</button>
              </div>
            </li>
            <li class="splide__slide box" data-index="2">
              <div class="history">
                <div class="info">
                  <h3>Antes del origen</h3>
                  <p>
                    Esa noche, reventaron 36 bombas en Lima. El Perú estaba
                    sumido en una crisis ocasionada por el terrorismo. Había que
                    decidir si seguir en el Perú o dejarlo todo y viajar al
                    extranjero.
                  </p>
                </div>
                <button class="build-btn" data-progress="50">1993</button>
              </div>
            </li>
            <li class="splide__slide box" data-index="3">
              <div class="history">
                <div class="info">
                  <h3>Antes del origen</h3>
                  <p>
                    Esa noche, reventaron 36 bombas en Lima. El Perú estaba
                    sumido en una crisis ocasionada por el terrorismo. Había que
                    decidir si seguir en el Perú o dejarlo todo y viajar al
                    extranjero.
                  </p>
                </div>
                <button class="build-btn" data-progress="75">1994</button>
              </div>
            </li>
            <li class="splide__slide box" data-index="4">
              <div class="history">
                <div class="info">
                  <h3>Antes del origen</h3>
                  <p>
                    Esa noche, reventaron 36 bombas en Lima. El Perú estaba
                    sumido en una crisis ocasionada por el terrorismo. Había que
                    decidir si seguir en el Perú o dejarlo todo y viajar al
                    extranjero.
                  </p>
                </div>
                <button class="build-btn" data-progress="100">2000</button>
              </div>
            </li>
            <li class="splide__slide box" data-index="5">
              <div class="history">
                <div class="info">
                  <h3>Antes del origen</h3>
                  <p>
                    Esa noche, reventaron 36 bombas en Lima. El Perú estaba
                    sumido en una crisis ocasionada por el terrorismo. Había que
                    decidir si seguir en el Perú o dejarlo todo y viajar al
                    extranjero.
                  </p>
                </div>
                <button class="build-btn" data-progress="125">2004</button>
              </div>
            </li>
            <li class="splide__slide box" data-index="6">
              <div class="history">
                <div class="info">
                  <h3>Antes del origen</h3>
                  <p>
                    Esa noche, reventaron 36 bombas en Lima. El Perú estaba
                    sumido en una crisis ocasionada por el terrorismo. Había que
                    decidir si seguir en el Perú o dejarlo todo y viajar al
                    extranjero.
                  </p>
                </div>
                <button class="build-btn" data-progress="150">2010</button>
              </div>
            </li>
            <li class="splide__slide box" data-index="7">
              <div class="history">
                <div class="info">
                  <h3>Antes del origen</h3>
                  <p>
                    Esa noche, reventaron 36 bombas en Lima. El Perú estaba
                    sumido en una crisis ocasionada por el terrorismo. Había que
                    decidir si seguir en el Perú o dejarlo todo y viajar al
                    extranjero.
                  </p>
                </div>
                <button class="build-btn" data-progress="175">2022</button>
              </div>
            </li>
            <li class="splide__slide box" data-index="8">
              <div class="history">
                <div class="info">
                  <h3>Antes del origen</h3>
                  <p>
                    Esa noche, reventaron 36 bombas en Lima. El Perú estaba
                    sumido en una crisis ocasionada por el terrorismo. Había que
                    decidir si seguir en el Perú o dejarlo todo y viajar al
                    extranjero.
                  </p>
                </div>
                <button class="build-btn" data-progress="200">2023</button>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </body>

  <script src="
https://cdn.jsdelivr.net/npm/@splidejs/splide@4.1.4/dist/js/splide.min.js
"></script>
  <!-- <script src="hoja.js"></script> -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const splide = new Splide("#splide-prueba", {
        type: "slide",
        perPage: 6,
        perMove: 1,
        gap: "2rem",
        pagination: false,
        padding: {
          left: "30px",
          right: "40px"
        },
        breakpoints: {
          420: {
            perPage: 2,
            perMove: 1
          }
        }
      }).mount();
    });
  </script>
  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    let lastX = 0;
  
    // Función para obtener el tamaño de una slide
    function getSlideWidth() {
      const activeSlide = document.querySelector(".splide__slide"); // Obtener una slide para medir
      return activeSlide.offsetWidth; // Devuelve el ancho de la slide
    }

    // Ajusta el tamaño del canvas al tamaño del contenedor
    function resizeCanvas() {
      canvas.width = document.querySelector(".splide").offsetWidth; // Ancho del canvas es el ancho de Splide
      canvas.height = 300; // Puedes ajustar esta altura según necesites
      drawInitialCanvas();
    }

    // Dibuja las curvas en el canvas según el progreso y el número de curvas
    function drawCurve(progress, totalCurves, finalX, finalY) {
      const initialX = lastX; // Empezar desde el último punto donde se quedó la curva anterior
      const initialY = canvas.height / 3;
      const curveHeight = canvas.height * 0.25;

      let curveLength = (finalX - initialX) / totalCurves;


      // ctx.clearRect(0, 0, canvas.width, canvas.height); // Limpiar el canvas
     
      ctx.setLineDash([5, 5]);
      ctx.beginPath();
      ctx.strokeStyle = "#6ab04c";
      ctx.lineWidth = 2;
      ctx.moveTo(initialX, finalY);
      
      let currentX = initialX;

      for (let i = 0; i < totalCurves; i++) {
        const startX = initialX + i * curveLength;
        const endX = startX + curveLength;
        const midX = (startX + endX) / 2;

        // if (endX > finalX) {
        //   const remainingDistance = finalX - startX;
        //   const adjustedMidX = startX + remainingDistance / 2;
        //   currentX = finalX;

        //   if (i % 2 === 0) {
        //     ctx.quadraticCurveTo(
        //       adjustedMidX,
        //       initialY + curveHeight,
        //       currentX,
        //       initialY
        //     );
        //   } else {
        //     ctx.quadraticCurveTo(
        //       adjustedMidX,
        //       initialY - curveHeight,
        //       currentX,
        //       initialY
        //     );
        //   }
        //   break;
        // }

        if (i % 2 === 0) {
          ctx.quadraticCurveTo(midX, initialY + curveHeight, endX, initialY);
        } else {
          ctx.quadraticCurveTo(midX, initialY - curveHeight, endX, initialY);
        }
        currentX = endX;
      }

      ctx.stroke();
      lastX = currentX; // Actualizar lastX al final de la curva
    }

    // Función para animar la curva
    function animateCurve(totalCurves, duration, finalX, finalY) {
      const startTime = performance.now();

      function animate(currentTime) {
        const elapsedTime = currentTime - startTime;
        const progress = Math.min(elapsedTime / duration, 1);


        drawCurve(progress, totalCurves, finalX, finalY);

        if (progress < 1) {
          requestAnimationFrame(animate);
        }
      }

      requestAnimationFrame(animate);
    }

    // Escuchar el click en los botones
    document.querySelectorAll(".build-btn").forEach((button) => {
      button.addEventListener("click", function () {
        // Obtener el índice del botón clicado
        const targetIndex = parseInt(
          this.closest(".splide__slide").getAttribute("data-index")
        );

        // Obtener la posición del botón en el canvas
        const buttonRect = this.getBoundingClientRect();
        const canvasRect = canvas.getBoundingClientRect();
        const finalX = buttonRect.right - canvasRect.left; // Posición X final en relación al canvas
        const finalY = buttonRect.top - canvasRect.top; // Posición Y final en relación al canvas
        // Dibuja solo hasta el índice clicado (1 curva menos para el primer elemento)
        const totalCurves = targetIndex;
      
        // Llamar a la animación de la curva con el número adecuado de curvas y el finalX calculado
        // animateCurve(totalCurves, 3000, finalX, finalY); // 1000ms = 1 segundo para la animación completa
        drawCurve(1, totalCurves, finalX, finalY);
      });
    });

    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();
  </script>
</html>
